generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique @db.VarChar(50)
  email     String   @unique @db.VarChar(100)
  password  String   @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")
  
  // Profile fields
  fullName  String?  @map("full_name") @db.VarChar(100)
  country   String?  @db.VarChar(100)
  province  String?  @db.VarChar(100)
  city      String?  @db.VarChar(100)
  whatsapp  String?  @db.VarChar(50)
  avatar    String?

  products         Product[]
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  questions        Question[]

  @@map("users")
}

model Product {
  id          Int      @id @default(autoincrement())
  userId      Int?     @map("user_id")
  name        String   @db.VarChar(255)
  description String?  @db.Text
  price       Decimal  @db.Decimal(10, 2)
  images      String[]
  categoryId  Int?     @map("category_id")
  createdAt   DateTime @default(now()) @map("created_at")

  user     User?     @relation(fields: [userId], references: [id])
  category Category? @relation(fields: [categoryId], references: [id])
  questions Question[]

  @@map("products")
}

model Category {
  id    Int    @id @default(autoincrement())
  name  String @unique @db.VarChar(100)
  
  products Product[]

  @@map("categories")
}

model Message {
  id         Int      @id @default(autoincrement())
  fromUserId Int?     @map("from_user")
  toUserId   Int?     @map("to_user")
  content    String   @db.Text
  readStatus Boolean? @default(false) @map("read_status")
  createdAt  DateTime @default(now()) @map("created_at")

  fromUser User? @relation("SentMessages", fields: [fromUserId], references: [id])
  toUser   User? @relation("ReceivedMessages", fields: [toUserId], references: [id])

  @@map("messages")
}

model Question {
  id        Int      @id @default(autoincrement())
  productId Int      @map("product_id")
  userId    Int      @map("user_id")
  content   String   @db.Text
  answer    String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  product Product @relation(fields: [productId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  @@map("questions")
}
